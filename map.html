<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HPC êµíšŒì§€ë„ | ONEBODY</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    :root{--bg:#0B1220;--card:#0F1A33;--text:#EAF0FF;--muted:rgba(234,240,255,.72);--line:rgba(234,240,255,.12);--shadow:0 18px 60px rgba(0,0,0,.35);}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR","Malgun Gothic",sans-serif;color:var(--text);background:var(--bg)}
    header{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line);background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));}
    .btn{padding:8px 10px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--text);cursor:pointer;font-size:12px}
    .btn:hover{border-color:rgba(125,211,252,.35);background:rgba(255,255,255,.07)}
    #map{height:calc(100vh - 52px)}
    .leaflet-control-layers{background:var(--card);color:var(--text);border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow)}
  </style>
</head>
<body>
  <header>
    <div>
      <button class="btn" onclick="location.href='./index.html'">â† í™ˆ</button>
      <button class="btn" id="locBtn">ğŸ“ ë‚´ ìœ„ì¹˜</button>
    </div>
    <small style="opacity:.7">ë ˆì´ì–´ ì²´í¬ë¡œ ì§€ì—­/êµ¬ê°„ë³„ í‘œì‹œë¥¼ ì¼œê³  ë„ì„¸ìš”</small>
  </header>
  <div id="map"></div>

  <script>
    window.addEventListener('load', () => {
      const map = L.map('map').setView([36.5, 127.8], 7);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

      let myMarker = null;
      document.getElementById('locBtn').onclick = () => {
        if (!navigator.geolocation) return alert('ìœ„ì¹˜ ê¸°ëŠ¥ ë¯¸ì§€ì›');
        navigator.geolocation.getCurrentPosition(p=>{
          const {latitude:lat, longitude:lng} = p.coords;
          if (myMarker) myMarker.remove();
          myMarker = L.marker([lat,lng]).addTo(map).bindPopup('ë‚´ ìœ„ì¹˜').openPopup();
          map.setView([lat,lng], 13);
        }, ()=>alert('ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆì–´ìš”'), {enableHighAccuracy:true, timeout:10000});
      };

      const overlays = {};
      async function addLayer(label, url){
        const res = await fetch(url);
        const geo = await res.json();
        const layer = L.geoJSON(geo, {
          pointToLayer: (f, latlng) => {
            const p = f.properties || {};
            const color = p['marker-color'] || p.color || '#7DD3FC';
            return L.circleMarker(latlng, {radius:6, color, fillColor:color, fillOpacity:.9, weight:2});
          },
          onEachFeature: (f, l) => {
            const p = f.properties || {};
            l.bindPopup(`<b>${p.name || p.title || 'êµíšŒ'}</b><br/>êµì¸ìˆ˜: ${p.members || p.êµì¸ìˆ˜ || 'ë¯¸ìƒ'}`);
          }
        });
        overlays[label] = layer;
      }

      Promise.all([
        addLayer('ì„œìš¸', './data/region/seoul.geojson'),
        addLayer('ê²½ê¸°', './data/region/gyeonggi.geojson'),
        addLayer('ì¶©ì²­', './data/region/chungcheong.geojson'),
        addLayer('ì „ë¼', './data/region/jeolla.geojson'),
        addLayer('ê°•ì›', './data/region/gangwon.geojson'),
        addLayer('ê²½ìƒ', './data/region/gyeongsang.geojson'),
        addLayer('ì œì£¼', './data/region/jeju.geojson'),
        addLayer('í•´ì™¸', './data/special/overseas.geojson'),
        addLayer('ì£¼ì†Œì—†ìŒ', './data/special/no_address.geojson'),
        addLayer('ê¸°íƒ€(í‘œê¸°ì´ìƒ)', './data/special/etc.geojson'),
        addLayer('0-8ëª…', './data/buckets/b_0_8.geojson'),
        addLayer('9-17ëª…', './data/buckets/b_9_17.geojson'),
        addLayer('18-27ëª…', './data/buckets/b_18_27.geojson'),
        addLayer('28-40ëª…', './data/buckets/b_28_40.geojson'),
        addLayer('44-70ëª…', './data/buckets/b_44_70.geojson'),
        addLayer('75-120ëª…', './data/buckets/b_75_120.geojson'),
        addLayer('145-300ëª…', './data/buckets/b_145_300.geojson'),
        addLayer('313-800ëª…', './data/buckets/b_313_800.geojson'),
        addLayer('1000-25000ëª…', './data/buckets/b_1000_25000.geojson'),
      ]).then(()=>{
        L.control.layers(null, overlays, { collapsed:false }).addTo(map);
      });
    });
  </script>
</body>
</html>
